<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voltage Drop Calculator - Free NEC Compliant | Sparky HQ</title>
    <meta name="description" content="Free voltage drop calculator for electricians. Check voltage drop, find max distance, or size wire. NEC Chapter 9 Table 8 with EGC sizing per 250.122(B).">
    <link rel="icon" type="image/png" href="/assets/logo.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#1c1c1c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="/css/style.css?v=7">
</head>
<body>
    <header class="site-header">
        <div class="container">
            <a href="/" class="logo"><img src="/assets/logo.png" alt="Sparky HQ" height="50"></a>
            <nav>
                <a href="/tools/">Tools</a>
                <a href="/about.html">About</a>
            </nav>
        </div>
    </header>

    <main>
        <section class="calc-page">
            <div class="container">
                <h1>Voltage Drop Calculator <span class="nec-ref">NEC Ch.9 Table 8</span></h1>
                <p class="subtitle">Calculate voltage drop, find max distance for a wire size, or determine the right conductor for your run.</p>

                <div class="method-toggle">
                    <button class="active" onclick="setMode('check')">Check VD</button>
                    <button onclick="setMode('distance')">Max Distance</button>
                    <button onclick="setMode('wiresize')">Size Wire</button>
                </div>

                <div class="calc-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="voltage">System Voltage</label>
                            <select id="voltage">
                                <option value="120">120V</option>
                                <option value="208">208V</option>
                                <option value="240" selected>240V</option>
                                <option value="277">277V</option>
                                <option value="480">480V</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="phase">Phase</label>
                            <select id="phase">
                                <option value="1" selected>Single Phase</option>
                                <option value="3">Three Phase</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="amps">Load (Amps)</label>
                            <input type="number" id="amps" placeholder="e.g. 20" min="0" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="material">Conductor Material</label>
                            <select id="material">
                                <option value="copper" selected>Copper</option>
                                <option value="aluminum">Aluminum</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" id="wireSizeGroup">
                            <label for="wireSize">Wire Size</label>
                            <select id="wireSize">
                                <option value="14">14 AWG</option>
                                <option value="12" selected>12 AWG</option>
                                <option value="10">10 AWG</option>
                                <option value="8">8 AWG</option>
                                <option value="6">6 AWG</option>
                                <option value="4">4 AWG</option>
                                <option value="3">3 AWG</option>
                                <option value="2">2 AWG</option>
                                <option value="1">1 AWG</option>
                                <option value="1/0">1/0 AWG</option>
                                <option value="2/0">2/0 AWG</option>
                                <option value="3/0">3/0 AWG</option>
                                <option value="4/0">4/0 AWG</option>
                                <option value="250">250 kcmil</option>
                                <option value="300">300 kcmil</option>
                                <option value="350">350 kcmil</option>
                                <option value="400">400 kcmil</option>
                                <option value="500">500 kcmil</option>
                                <option value="600">600 kcmil</option>
                                <option value="750">750 kcmil</option>
                            </select>
                        </div>
                        <div class="form-group" id="distanceGroup">
                            <label for="distance">One-Way Distance (ft)</label>
                            <input type="number" id="distance" placeholder="e.g. 150" min="0" step="1">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" id="vdLimitGroup">
                            <label for="vdLimit">VD Limit</label>
                            <select id="vdLimit">
                                <option value="3" selected>3% (Branch Circuit)</option>
                                <option value="5">5% (Total Feeder + Branch)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="ocpd">OCPD / Breaker (optional)</label>
                            <select id="ocpd">
                                <option value="">— Skip EGC calc —</option>
                                <option value="15">15A</option>
                                <option value="20">20A</option>
                                <option value="25">25A</option>
                                <option value="30">30A</option>
                                <option value="35">35A</option>
                                <option value="40">40A</option>
                                <option value="50">50A</option>
                                <option value="60">60A</option>
                                <option value="70">70A</option>
                                <option value="80">80A</option>
                                <option value="100">100A</option>
                                <option value="125">125A</option>
                                <option value="150">150A</option>
                                <option value="200">200A</option>
                                <option value="225">225A</option>
                                <option value="250">250A</option>
                                <option value="300">300A</option>
                                <option value="350">350A</option>
                                <option value="400">400A</option>
                                <option value="500">500A</option>
                                <option value="600">600A</option>
                                <option value="800">800A</option>
                                <option value="1000">1000A</option>
                                <option value="1200">1200A</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn" onclick="calculate()">Calculate</button>
                </div>

                <div class="result" id="result"></div>
            </div>
        </section>
        <div class="disclaimer-box">
            <p>For reference only. Verify all results with the current NEC and local amendments. See <a href="/terms.html">Terms of Use</a>.</p>
        </div>
    </main>

    <footer class="site-footer">
        <div class="container">
            <p>&copy; 2026 Sparky HQ.</p>
            <p>Tools are for reference only. Always verify with the current NEC and local amendments. <a href="/terms.html" style="color:#aaa;text-decoration:underline;">Terms of Use</a></p>
        </div>
    </footer>

    <script>
    // ── NEC Data ──

    // NEC Ch.9 Table 8 - DC Resistance at 75°C (ohms/1000ft)
    var wireResistance = {
        copper: {
            '14':3.14,'12':1.98,'10':1.24,'8':0.778,'6':0.491,'4':0.308,'3':0.245,'2':0.194,
            '1':0.154,'1/0':0.122,'2/0':0.0967,'3/0':0.0766,'4/0':0.0608,
            '250':0.0515,'300':0.0429,'350':0.0367,'400':0.0321,'500':0.0258,'600':0.0214,'750':0.0171
        },
        aluminum: {
            '14':5.17,'12':3.25,'10':2.04,'8':1.28,'6':0.808,'4':0.508,'3':0.403,'2':0.319,
            '1':0.253,'1/0':0.201,'2/0':0.159,'3/0':0.126,'4/0':0.100,
            '250':0.0847,'300':0.0707,'350':0.0605,'400':0.0529,'500':0.0424,'600':0.0353,'750':0.0282
        }
    };

    // Wire sizes in order (smallest to largest)
    var wireSizes = ['14','12','10','8','6','4','3','2','1','1/0','2/0','3/0','4/0','250','300','350','400','500','600','750'];

    // Circular mil area per conductor
    var cmil = {
        '14':4110,'12':6530,'10':10380,'8':16510,'6':26240,'4':41740,'3':52620,'2':66360,
        '1':83690,'1/0':105600,'2/0':133100,'3/0':167800,'4/0':211600,
        '250':250000,'300':300000,'350':350000,'400':400000,'500':500000,'600':600000,'750':750000
    };

    // Wire size display labels
    var wireLabel = {
        '14':'#14','12':'#12','10':'#10','8':'#8','6':'#6','4':'#4','3':'#3','2':'#2',
        '1':'#1','1/0':'1/0','2/0':'2/0','3/0':'3/0','4/0':'4/0',
        '250':'250','300':'300','350':'350','400':'400','500':'500','600':'600','750':'750'
    };

    // NEC 310.16 ampacity 75°C column (for min conductor sizing)
    var ampacity75 = {
        copper: {
            '14':20,'12':25,'10':35,'8':50,'6':65,'4':85,'3':100,'2':115,
            '1':130,'1/0':150,'2/0':175,'3/0':200,'4/0':230,
            '250':255,'300':285,'350':310,'400':335,'500':380,'600':420,'750':475
        },
        aluminum: {
            '12':20,'10':30,'8':40,'6':50,'4':65,'3':75,'2':90,
            '1':100,'1/0':120,'2/0':135,'3/0':155,'4/0':180,
            '250':205,'300':230,'350':250,'400':270,'500':310,'600':340,'750':385
        }
    };

    // NEC 250.122 - Min EGC size by OCPD rating
    // Format: ocpd threshold -> {copper: size, aluminum: size}
    var egcTable = [
        {max:15,  cu:'14', al:'12'},
        {max:20,  cu:'12', al:'10'},
        {max:60,  cu:'10', al:'8'},
        {max:100, cu:'8',  al:'6'},
        {max:200, cu:'6',  al:'4'},
        {max:300, cu:'4',  al:'2'},
        {max:400, cu:'3',  al:'1'},
        {max:500, cu:'2',  al:'1/0'},
        {max:600, cu:'1',  al:'2/0'},
        {max:800, cu:'1/0',al:'3/0'},
        {max:1000,cu:'2/0',al:'4/0'},
        {max:1200,cu:'3/0',al:'250'}
    ];

    // ── Mode Management ──
    var currentMode = 'check';

    function setMode(mode) {
        currentMode = mode;
        var buttons = document.querySelectorAll('.method-toggle button');
        buttons.forEach(function(b) { b.classList.remove('active'); });
        if (mode === 'check') buttons[0].classList.add('active');
        if (mode === 'distance') buttons[1].classList.add('active');
        if (mode === 'wiresize') buttons[2].classList.add('active');

        var ws = document.getElementById('wireSizeGroup');
        var ds = document.getElementById('distanceGroup');
        var vl = document.getElementById('vdLimitGroup');

        // Show/hide fields based on mode
        ws.style.display = (mode === 'wiresize') ? 'none' : '';
        ds.style.display = (mode === 'distance') ? 'none' : '';
        vl.style.display = (mode === 'check') ? 'none' : '';

        document.getElementById('result').classList.remove('show');
        document.getElementById('result').innerHTML = '';
    }

    // ── Helper Functions ──

    function getMinWireForAmps(amps, material) {
        var table = ampacity75[material];
        var startIdx = material === 'aluminum' ? 1 : 0; // aluminum starts at 12
        for (var i = startIdx; i < wireSizes.length; i++) {
            var size = wireSizes[i];
            if (table[size] && table[size] >= amps) return size;
        }
        return wireSizes[wireSizes.length - 1];
    }

    function getEGC(ocpdVal, material) {
        var key = material === 'aluminum' ? 'al' : 'cu';
        for (var i = 0; i < egcTable.length; i++) {
            if (ocpdVal <= egcTable[i].max) return egcTable[i][key];
        }
        return egcTable[egcTable.length - 1][key];
    }

    function nextSizeUp(targetCmil, material) {
        var startIdx = material === 'aluminum' ? 1 : 0;
        for (var i = startIdx; i < wireSizes.length; i++) {
            if (cmil[wireSizes[i]] >= targetCmil) return wireSizes[i];
        }
        return wireSizes[wireSizes.length - 1];
    }

    function calcVD(R, factor, distance, amps) {
        return (factor * distance * amps * R) / 1000;
    }

    function sizeLabel(size) {
        var n = parseInt(size);
        if (!isNaN(n) && n >= 250) return size + ' kcmil';
        return wireLabel[size] + ' AWG';
    }

    // ── EGC Calculation ──
    function calcEGC(ocpdVal, material, actualWire, amps) {
        if (!ocpdVal) return null;

        var minEGC = getEGC(ocpdVal, material);
        var minWire = getMinWireForAmps(amps, material);

        // If actual conductor is larger than min required, proportional increase applies
        var minCmil = cmil[minWire];
        var actualCmil = cmil[actualWire];

        var result = {
            minEGC: minEGC,
            minEGCLabel: sizeLabel(minEGC),
            proportional: false,
            propEGC: null,
            propEGCLabel: null,
            minWire: minWire,
            actualWire: actualWire
        };

        if (actualCmil > minCmil) {
            var minEGCcmil = cmil[minEGC];
            var newEGCcmil = minEGCcmil * (actualCmil / minCmil);
            var propSize = nextSizeUp(newEGCcmil, material);
            // Only show if proportional is larger than minimum
            if (cmil[propSize] > cmil[minEGC]) {
                result.proportional = true;
                result.propEGC = propSize;
                result.propEGCLabel = sizeLabel(propSize);
            }
        }

        return result;
    }

    // ── Main Calculate ──
    function calculate() {
        var voltage = parseFloat(document.getElementById('voltage').value);
        var phase = parseInt(document.getElementById('phase').value);
        var amps = parseFloat(document.getElementById('amps').value);
        var material = document.getElementById('material').value;
        var factor = phase === 3 ? 1.732 : 2;
        var ocpdVal = document.getElementById('ocpd').value ? parseInt(document.getElementById('ocpd').value) : null;

        if (!amps || amps <= 0) { alert('Enter load amps.'); return; }

        var html = '';

        if (currentMode === 'check') {
            // ── Check VD Mode ──
            var wireSize = document.getElementById('wireSize').value;
            var distance = parseFloat(document.getElementById('distance').value);
            if (!distance) { alert('Enter one-way distance.'); return; }

            var R = wireResistance[material][wireSize];
            var vd = calcVD(R, factor, distance, amps);
            var vdPct = (vd / voltage) * 100;
            var deliveredV = voltage - vd;
            var pass3 = vdPct <= 3;
            var pass5 = vdPct <= 5;

            html += '<div class="result-section">';
            html += '<div class="result-value">' + vd.toFixed(2) + ' V (' + vdPct.toFixed(2) + '%)</div>';
            html += '<div class="result-label">Voltage Drop</div>';
            html += '</div>';
            html += '<table class="breakdown-table">';
            html += '<tr><td>Delivered Voltage</td><td>' + deliveredV.toFixed(1) + ' V</td></tr>';
            html += '<tr><td>Branch Circuit (3% max)</td><td>' + vdPct.toFixed(2) + '% &mdash; <span class="' + (pass3 ? 'result-pass' : 'result-fail') + '">' + (pass3 ? 'PASS' : 'FAIL') + '</span></td></tr>';
            html += '<tr><td>Total Circuit (5% max)</td><td>' + vdPct.toFixed(2) + '% &mdash; <span class="' + (pass5 ? 'result-pass' : 'result-fail') + '">' + (pass5 ? 'PASS' : 'FAIL') + '</span></td></tr>';
            html += '</table>';

            // EGC
            var egc = calcEGC(ocpdVal, material, wireSize, amps);
            if (egc) {
                html += buildEGChtml(egc, material);
            }

        } else if (currentMode === 'distance') {
            // ── Max Distance Mode ──
            var wireSize = document.getElementById('wireSize').value;
            var vdLimit = parseFloat(document.getElementById('vdLimit').value) / 100;

            var R = wireResistance[material][wireSize];
            var maxDist = (vdLimit * voltage * 1000) / (factor * amps * R);

            html += '<div class="result-section">';
            html += '<div class="result-value">' + Math.floor(maxDist) + ' ft</div>';
            html += '<div class="result-label">Max One-Way Distance at ' + (vdLimit * 100) + '% with ' + sizeLabel(wireSize) + ' ' + cap(material) + '</div>';
            html += '</div>';
            html += '<table class="breakdown-table">';
            html += '<tr><td>Wire</td><td>' + sizeLabel(wireSize) + ' ' + cap(material) + '</td></tr>';
            html += '<tr><td>Load</td><td>' + amps + 'A @ ' + voltage + 'V ' + (phase === 3 ? '3\u03D5' : '1\u03D5') + '</td></tr>';
            html += '<tr><td>Resistance</td><td>' + R + ' \u03A9/1000ft</td></tr>';
            html += '<tr><td>VD at max distance</td><td>' + (vdLimit * 100).toFixed(0) + '% (' + (vdLimit * voltage).toFixed(1) + 'V)</td></tr>';
            html += '</table>';

            var egc = calcEGC(ocpdVal, material, wireSize, amps);
            if (egc) {
                html += buildEGChtml(egc, material);
            }

        } else if (currentMode === 'wiresize') {
            // ── Size Wire Mode ──
            var distance = parseFloat(document.getElementById('distance').value);
            if (!distance) { alert('Enter one-way distance.'); return; }
            var vdLimit = parseFloat(document.getElementById('vdLimit').value) / 100;

            var startIdx = material === 'aluminum' ? 1 : 0;
            var recommended = null;
            var recVD = 0;

            for (var i = startIdx; i < wireSizes.length; i++) {
                var size = wireSizes[i];
                var R = wireResistance[material][size];
                var vd = calcVD(R, factor, distance, amps);
                var vdPct = (vd / voltage) * 100;
                if (vdPct <= vdLimit * 100) {
                    recommended = size;
                    recVD = vdPct;
                    break;
                }
            }

            if (!recommended) {
                html += '<div class="result-section">';
                html += '<div class="result-value result-fail">No Standard Size</div>';
                html += '<div class="result-label">No single conductor meets ' + (vdLimit * 100) + '% VD limit at this distance and load. Consider parallel runs.</div>';
                html += '</div>';
            } else {
                var minAmpWire = getMinWireForAmps(amps, material);
                var ampIdx = wireSizes.indexOf(minAmpWire);
                var recIdx = wireSizes.indexOf(recommended);
                var upsized = recIdx > ampIdx;

                html += '<div class="result-section">';
                html += '<div class="result-value">' + sizeLabel(recommended) + ' ' + cap(material) + '</div>';
                html += '<div class="result-label">Minimum conductor for ' + (vdLimit * 100) + '% VD limit</div>';
                html += '</div>';
                html += '<table class="breakdown-table">';
                html += '<tr><td>VD at ' + sizeLabel(recommended) + '</td><td>' + recVD.toFixed(2) + '% (' + (recVD / 100 * voltage).toFixed(1) + 'V drop)</td></tr>';
                html += '<tr><td>Delivered Voltage</td><td>' + (voltage - (recVD / 100 * voltage)).toFixed(1) + 'V</td></tr>';
                html += '<tr><td>Min for Ampacity (310.16)</td><td>' + sizeLabel(minAmpWire) + ' (' + ampacity75[material][minAmpWire] + 'A @ 75\u00B0C)</td></tr>';
                if (upsized) {
                    html += '<tr><td>Upsized for VD?</td><td><span class="result-fail">Yes</span> &mdash; ' + sizeLabel(minAmpWire) + ' \u2192 ' + sizeLabel(recommended) + '</td></tr>';
                } else {
                    html += '<tr><td>Upsized for VD?</td><td><span class="result-pass">No</span></td></tr>';
                }
                html += '</table>';

                var egc = calcEGC(ocpdVal, material, recommended, amps);
                if (egc) {
                    html += buildEGChtml(egc, material);
                }
            }
        }

        var resultEl = document.getElementById('result');
        resultEl.innerHTML = html;
        resultEl.classList.add('show');
    }

    function buildEGChtml(egc, material) {
        var h = '<div style="margin-top:20px;padding-top:16px;border-top:1px solid var(--border);">';
        h += '<div style="font-weight:700;font-size:0.92rem;margin-bottom:8px;">Equipment Grounding Conductor <span class="nec-ref">250.122</span></div>';
        h += '<table class="breakdown-table">';
        h += '<tr><td>Min EGC per 250.122</td><td>' + egc.minEGCLabel + ' ' + cap(material) + '</td></tr>';
        if (egc.proportional) {
            h += '<tr><td>Proportional EGC per 250.122(B)</td><td><strong>' + egc.propEGCLabel + ' ' + cap(material) + '</strong></td></tr>';
            h += '<tr><td>Reason</td><td>Conductor upsized from ' + sizeLabel(egc.minWire) + ' to ' + sizeLabel(egc.actualWire) + ' &mdash; EGC must increase proportionally</td></tr>';
        }
        h += '</table></div>';
        return h;
    }

    function cap(s) { return s.charAt(0).toUpperCase() + s.slice(1); }

    // Initialize: hide VD limit in check mode
    setMode('check');
    </script>
    <script src="/js/app.js" defer></script>
</body>
</html>
