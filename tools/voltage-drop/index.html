<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voltage Drop Calculator - Free NEC Compliant | Sparky HQ</title>
    <meta name="description" content="Free voltage drop calculator for electricians. Check voltage drop or find max distance for any wire run. NEC Chapter 9 Table 8. Supports DC, single-phase, and three-phase.">
    <link rel="icon" type="image/png" href="/assets/logo.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#1c1c1c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="canonical" href="https://sparky-hq.com/tools/voltage-drop/">
    <meta property="og:title" content="Voltage Drop Calculator - Free NEC Compliant | Sparky HQ">
    <meta property="og:description" content="Free voltage drop calculator for electricians. Check voltage drop or find max distance for any wire run. NEC Chapter 9 Table 8. Supports DC, single-phase, and three-phase.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://sparky-hq.com/tools/voltage-drop/">
    <meta property="og:image" content="https://sparky-hq.com/assets/og-image.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Voltage Drop Calculator - Free NEC Compliant | Sparky HQ">
    <meta name="twitter:description" content="Free voltage drop calculator for electricians. Check voltage drop or find max distance for any wire run. NEC Chapter 9 Table 8. Supports DC, single-phase, and three-phase.">
    <meta name="twitter:image" content="https://sparky-hq.com/assets/og-image.png">
    <link rel="stylesheet" href="/css/style.css?v=13">
    <script src="/js/validate.js" defer></script>
</head>
<body>
    <header class="site-header">
        <div class="container">
            <a href="/" class="logo"><img src="/assets/logo.png" alt="Sparky HQ" height="50"></a>
            <nav>
                <a href="/tools/">Tools</a>
                <a href="/tables/">Tables</a>
                <a href="/about.html">About</a>
            </nav>
        </div>
    </header>

    <main>
        <section class="calc-page">
            <div class="container">
                <h1>Voltage Drop Calculator <span class="nec-ref">NEC Ch.9 Table 8</span></h1>
                <p class="subtitle">Check voltage drop or find max distance for any wire run. For conductor sizing, ampacity, and derating, use the <a href="/tools/wire-size/">Wire Size Calculator</a>.</p>

                <div class="method-toggle">
                    <button class="active" onclick="setMode('check')">Check Voltage Drop</button>
                    <button onclick="setMode('distance')">Max Distance</button>
                    <button onclick="setMode('conductor')">Size Conductor</button>
                </div>

                <div class="calc-form">
                    <div class="form-group">
                        <label for="voltage">System Voltage</label>
                        <select id="voltage">
                            <option value="120">120V</option>
                            <option value="208">208V</option>
                            <option value="240" selected>240V</option>
                            <option value="277">277V</option>
                            <option value="480">480V</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="circuit">Circuit Type</label>
                        <select id="circuit">
                            <option value="1ac" selected>Single Phase AC</option>
                            <option value="3ac">Three Phase AC</option>
                            <option value="dc">DC</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="amps">Load (Amps)</label>
                        <input type="number" id="amps" placeholder="e.g. 20" min="0" step="0.1">
                    </div>

                    <div class="form-group">
                        <label for="material">Conductor Material</label>
                        <select id="material">
                            <option value="copper" selected>Copper</option>
                            <option value="aluminum">Aluminum</option>
                        </select>
                    </div>

                    <div class="form-group" id="ocpdGroup" style="display:none;">
                        <label for="ocpd">OCPD / Breaker Size <span class="nec-ref">250.122</span></label>
                        <select id="ocpd">
                            <option value="">— Not specified —</option>
                            <option value="15">15A</option>
                            <option value="20">20A</option>
                            <option value="25">25A</option>
                            <option value="30">30A</option>
                            <option value="35">35A</option>
                            <option value="40">40A</option>
                            <option value="50">50A</option>
                            <option value="60">60A</option>
                            <option value="70">70A</option>
                            <option value="80">80A</option>
                            <option value="100">100A</option>
                            <option value="125">125A</option>
                            <option value="150">150A</option>
                            <option value="200">200A</option>
                            <option value="225">225A</option>
                            <option value="250">250A</option>
                            <option value="300">300A</option>
                            <option value="350">350A</option>
                            <option value="400">400A</option>
                            <option value="500">500A</option>
                            <option value="600">600A</option>
                            <option value="800">800A</option>
                            <option value="1000">1000A</option>
                            <option value="1200">1200A</option>
                        </select>
                        <p class="field-note">Required for EGC sizing per NEC 250.122</p>
                    </div>

                    <div class="form-group" id="wireSizeGroup">
                        <label for="wireSize">Wire Size</label>
                        <select id="wireSize">
                            <option value="14">14 AWG</option>
                            <option value="12" selected>12 AWG</option>
                            <option value="10">10 AWG</option>
                            <option value="8">8 AWG</option>
                            <option value="6">6 AWG</option>
                            <option value="4">4 AWG</option>
                            <option value="3">3 AWG</option>
                            <option value="2">2 AWG</option>
                            <option value="1">1 AWG</option>
                            <option value="1/0">1/0 AWG</option>
                            <option value="2/0">2/0 AWG</option>
                            <option value="3/0">3/0 AWG</option>
                            <option value="4/0">4/0 AWG</option>
                            <option value="250">250 kcmil</option>
                            <option value="300">300 kcmil</option>
                            <option value="350">350 kcmil</option>
                            <option value="400">400 kcmil</option>
                            <option value="500">500 kcmil</option>
                            <option value="600">600 kcmil</option>
                            <option value="750">750 kcmil</option>
                        </select>
                    </div>

                    <div class="form-group" id="distanceGroup">
                        <label for="distance">One-Way Distance (ft)</label>
                        <input type="number" id="distance" placeholder="e.g. 150" min="0" step="1">
                    </div>

                    <div class="apply-section">
                        <p class="apply-terms">By clicking Apply, you acknowledge that results are for reference only and must be verified by a qualified electrician against the current National Electrical Code and local amendments.</p>
                        <button class="btn" onclick="applyCalc()">Apply</button>
                    </div>
                </div>

                <div id="validation-messages"></div>
                <div class="result" id="result"></div>
            </div>
        </section>
        <div class="disclaimer-box">
            <p>For reference only. Verify all results with the current NEC and local amendments. See <a href="/terms.html">Terms of Use</a>.</p>
        </div>
    </main>

    <footer class="site-footer">
        <div class="container">
            <p>&copy; 2026 Sparky HQ.</p>
            <p>Tools are for reference only. Always verify with the current NEC and local amendments. <a href="/terms.html" style="color:#aaa;text-decoration:underline;">Terms of Use</a></p>
            <p style="font-size:0.75rem;color:#777;margin-top:6px;">NFPA 70, National Electrical Code, and NEC are registered trademarks of the National Fire Protection Association, Quincy, MA. Sparky HQ is not affiliated with or endorsed by NFPA.</p>
        </div>
    </footer>

    <script>
    // ══════════════════════════════════════
    //  NEC DATA TABLES
    // ══════════════════════════════════════

    // NEC Ch.9 Table 8 — DC Resistance at 75°C (ohms/1000ft)
    var wireResistance = {
        copper: {
            '14':3.14,'12':1.98,'10':1.24,'8':0.778,'6':0.491,'4':0.308,'3':0.245,'2':0.194,
            '1':0.154,'1/0':0.122,'2/0':0.0967,'3/0':0.0766,'4/0':0.0608,
            '250':0.0515,'300':0.0429,'350':0.0367,'400':0.0321,'500':0.0258,'600':0.0214,'750':0.0171
        },
        aluminum: {
            '14':5.17,'12':3.25,'10':2.04,'8':1.28,'6':0.808,'4':0.508,'3':0.403,'2':0.319,
            '1':0.253,'1/0':0.201,'2/0':0.159,'3/0':0.126,'4/0':0.100,
            '250':0.0847,'300':0.0707,'350':0.0605,'400':0.0529,'500':0.0424,'600':0.0353,'750':0.0282
        }
    };

    // Wire sizes in order smallest → largest
    var wireSizes = ['14','12','10','8','6','4','3','2','1','1/0','2/0','3/0','4/0',
                     '250','300','350','400','500','600','750'];

    // Display labels
    var wireLabel = {
        '14':'#14','12':'#12','10':'#10','8':'#8','6':'#6','4':'#4','3':'#3','2':'#2',
        '1':'#1','1/0':'1/0','2/0':'2/0','3/0':'3/0','4/0':'4/0',
        '250':'250','300':'300','350':'350','400':'400','500':'500','600':'600','750':'750'
    };

    // NEC 310.16 — 60°C column (basic ampacity check only)
    var basicAmpacity = {
        copper: { '14':15,'12':20,'10':30,'8':40,'6':55,'4':70,'3':85,'2':95,
                  '1':110,'1/0':125,'2/0':145,'3/0':165,'4/0':195,
                  '250':215,'300':240,'350':260,'400':280,'500':320,'600':350,'750':385 },
        aluminum: { '14':null,'12':15,'10':25,'8':30,'6':40,'4':55,'3':65,'2':75,
                    '1':85,'1/0':100,'2/0':115,'3/0':130,'4/0':150,
                    '250':170,'300':190,'350':210,'400':225,'500':260,'600':285,'750':320 }
    };

    // Circular mil areas
    var cmil = {
        '14':4110,'12':6530,'10':10380,'8':16510,'6':26240,'4':41740,'3':52620,'2':66360,
        '1':83690,'1/0':105600,'2/0':133100,'3/0':167800,'4/0':211600,
        '250':250000,'300':300000,'350':350000,'400':400000,'500':500000,'600':600000,'750':750000
    };

    // NEC 250.122 — Min EGC by OCPD rating
    var egcTable = [
        {max:15,cu:'14',al:'12'},{max:20,cu:'12',al:'10'},{max:60,cu:'10',al:'8'},
        {max:100,cu:'8',al:'6'},{max:200,cu:'6',al:'4'},{max:300,cu:'4',al:'2'},
        {max:400,cu:'3',al:'1'},{max:500,cu:'2',al:'1/0'},{max:600,cu:'1',al:'2/0'},
        {max:800,cu:'1/0',al:'3/0'},{max:1000,cu:'2/0',al:'4/0'},{max:1200,cu:'3/0',al:'250'}
    ];

    // ══════════════════════════════════════
    //  MODE MANAGEMENT
    // ══════════════════════════════════════

    var currentMode = 'check';

    function setMode(mode) {
        currentMode = mode;
        var buttons = document.querySelectorAll('.method-toggle button');
        buttons.forEach(function(b) { b.classList.remove('active'); });
        if (mode === 'check') buttons[0].classList.add('active');
        if (mode === 'distance') buttons[1].classList.add('active');
        if (mode === 'conductor') buttons[2].classList.add('active');

        document.getElementById('ocpdGroup').style.display = (mode === 'conductor') ? '' : 'none';
        document.getElementById('wireSizeGroup').style.display = (mode === 'conductor') ? 'none' : '';
        document.getElementById('distanceGroup').style.display = (mode === 'distance') ? 'none' : '';

        document.getElementById('result').classList.remove('show');
        document.getElementById('result').innerHTML = '';
    }

    // ══════════════════════════════════════
    //  HELPERS
    // ══════════════════════════════════════

    function calcVD(R, factor, distance, amps) {
        return (factor * distance * amps * R) / 1000;
    }

    function sizeLabel(size) {
        var n = parseInt(size);
        if (!isNaN(n) && n >= 250) return size + ' kcmil';
        return wireLabel[size] + ' AWG';
    }

    function cap(s) { return s.charAt(0).toUpperCase() + s.slice(1); }

    function circuitLabel(circuit) {
        if (circuit === 'dc') return 'DC';
        if (circuit === '3ac') return '3\u03D5 AC';
        return '1\u03D5 AC';
    }

    function getFactor(circuit) {
        return (circuit === '3ac') ? 1.732 : 2;
    }

    function getEGC(ocpdVal, material) {
        var key = (material === 'aluminum') ? 'al' : 'cu';
        for (var i = 0; i < egcTable.length; i++) {
            if (ocpdVal <= egcTable[i].max) return egcTable[i][key];
        }
        return egcTable[egcTable.length - 1][key];
    }

    function nextSizeUp(targetCmil, material) {
        var startIdx = (material === 'aluminum') ? 1 : 0;
        for (var i = startIdx; i < wireSizes.length; i++) {
            if (cmil[wireSizes[i]] >= targetCmil) return wireSizes[i];
        }
        return wireSizes[wireSizes.length - 1];
    }

    // ══════════════════════════════════════
    //  SHOW YOUR WORK
    // ══════════════════════════════════════

    function buildShowWork(formula, substituted, answer, steps) {
        var h = '<div style="margin-top:20px;padding-top:16px;border-top:1px solid var(--border);">';
        h += '<details style="cursor:pointer;">';
        h += '<summary style="font-weight:700;font-size:0.92rem;color:var(--accent);padding:10px 16px;user-select:none;background:var(--gray);border-left:4px solid var(--accent);border-radius:0 6px 6px 0;">Show Your Work</summary>';
        h += '<div style="margin-top:12px;">';

        // Formula
        h += '<div style="background:var(--gray);border-radius:6px;padding:12px 16px;margin-bottom:12px;">';
        h += '<div style="font-size:0.78rem;color:var(--text-muted);margin-bottom:4px;">Formula</div>';
        h += '<div style="font-family:\'Courier New\',monospace;font-size:0.95rem;font-weight:600;color:var(--text);">' + formula + '</div>';
        h += '</div>';

        // Substitution
        h += '<div style="background:var(--gray);border-radius:6px;padding:12px 16px;margin-bottom:12px;">';
        h += '<div style="font-size:0.78rem;color:var(--text-muted);margin-bottom:4px;">Substitution</div>';
        h += '<div style="font-family:\'Courier New\',monospace;font-size:0.92rem;color:var(--text);">' + substituted + '</div>';
        h += '<div style="font-family:\'Courier New\',monospace;font-size:0.92rem;font-weight:700;color:var(--text);margin-top:4px;">' + answer + '</div>';
        h += '</div>';

        // Step-by-step breakdown
        if (steps && steps.length > 0) {
            h += '<table class="breakdown-table" style="font-size:0.85rem;">';
            for (var i = 0; i < steps.length; i++) {
                h += '<tr><td style="white-space:nowrap;vertical-align:top;">' + steps[i][0] + '</td><td>' + steps[i][1] + '</td></tr>';
            }
            h += '</table>';
        }

        h += '</div></details></div>';
        return h;
    }

    // ══════════════════════════════════════
    //  MAIN CALCULATE
    // ══════════════════════════════════════

    function applyCalc() {
        var amps = parseFloat(document.getElementById('amps').value) || 0;
        var distance = parseFloat(document.getElementById('distance').value) || 0;

        var rules = [
            { rule: 'gt', value: amps, min: 0, label: 'Load (amps)', msg: 'Enter a load greater than 0 amps' },
            { rule: 'range', value: amps, max: 10000, label: 'Load (amps)', msg: 'Load exceeds 10,000A \u2014 verify input' }
        ];

        if (currentMode !== 'distance') {
            rules.push({ rule: 'gt', value: distance, min: 0, label: 'Distance', msg: 'Enter a distance greater than 0 feet' });
            rules.push({ rule: 'range', value: distance, max: 5000, label: 'Distance', level: 'warning', msg: 'Distance over 5,000 ft is unusual \u2014 verify input' });
        }

        var result = SparkyValidate.check(rules);
        SparkyValidate.showMessages('validation-messages', result);

        if (!result.valid) return;

        SparkyValidate.logApply();
        calculate();
    }

    function calculate() {
        var voltage = parseFloat(document.getElementById('voltage').value);
        var circuit = document.getElementById('circuit').value;
        var amps = parseFloat(document.getElementById('amps').value);
        var material = document.getElementById('material').value;
        var factor = getFactor(circuit);
        var formulaLabel = (circuit === '3ac') ? '1.732' : '2';

        if (!amps || amps <= 0) { return; }

        var html = '';
        var infoNote = (currentMode === 'conductor')
            ? '<div class="info-box" style="margin-top:16px;">Use the <a href="/tools/wire-size/"><strong>Wire Size Calculator</strong></a> for ampacity derating and 110.14(C) terminal temperature ratings.</div>'
            : '<div class="info-box" style="margin-top:16px;">This calculator checks voltage drop only. Use the <a href="/tools/wire-size/"><strong>Wire Size Calculator</strong></a> to verify ampacity, derating, and conductor sizing.</div>';

        // ── CHECK VOLTAGE DROP ──
        if (currentMode === 'check') {
            var wireSize = document.getElementById('wireSize').value;
            var distance = parseFloat(document.getElementById('distance').value);
            if (!distance) { return; }

            var R = wireResistance[material][wireSize];
            var vd = calcVD(R, factor, distance, amps);
            var vdPct = (vd / voltage) * 100;
            var deliveredV = voltage - vd;
            if (deliveredV < 0) deliveredV = 0;
            var pass3 = vdPct <= 3;
            var pass5 = vdPct <= 5;

            html += '<div style="font-weight:700;font-size:1.1rem;margin-bottom:14px;padding:10px 16px;background:#f5f0e6;border-left:4px solid var(--accent);border-radius:0 6px 6px 0;color:var(--text);">Response</div>';
            html += '<div class="result-section">';
            html += '<div class="result-value">' + vd.toFixed(2) + ' V (' + vdPct.toFixed(2) + '%)</div>';
            html += '<div class="result-label">Voltage Drop \u2014 ' + sizeLabel(wireSize) + ' ' + cap(material) + ' @ ' + distance + ' ft</div>';
            html += '</div>';
            html += '<table class="breakdown-table">';
            html += '<tr><td>Circuit</td><td>' + voltage + 'V ' + circuitLabel(circuit) + ' \u2014 ' + amps + 'A</td></tr>';
            html += '<tr><td>Delivered Voltage</td><td>' + (vd >= voltage ? '0 V (voltage drop exceeds source)' : deliveredV.toFixed(1) + ' V') + '</td></tr>';
            html += '<tr><td>Branch Circuit (3% max)</td><td>' + vdPct.toFixed(2) + '% \u2014 <span class="' + (pass3 ? 'result-pass' : 'result-fail') + '">' + (pass3 ? 'PASS' : 'FAIL') + '</span></td></tr>';
            html += '<tr><td>Total Circuit (5% max)</td><td>' + vdPct.toFixed(2) + '% \u2014 <span class="' + (pass5 ? 'result-pass' : 'result-fail') + '">' + (pass5 ? 'PASS' : 'FAIL') + '</span></td></tr>';
            html += '</table>';

            if (!pass3 && pass5) {
                html += '<div class="caution-box"><strong>Consider upsizing:</strong> Voltage drop exceeds 3% for a branch circuit. Use <strong>Max Distance</strong> mode to find the maximum run length, or the <a href="/tools/wire-size/"><strong>Wire Size Calculator</strong></a> to find the right conductor.</div>';
            } else if (!pass5) {
                html += '<div class="warning-box"><strong>Exceeds 5% total:</strong> This run has excessive voltage drop even for combined feeder + branch. Consider a shorter route, larger conductor, or higher system voltage.</div>';
            }

            var wireAmp = basicAmpacity[material][wireSize];
            if (wireAmp === null) {
                html += '<div class="warning-box"><strong>NEC 310.3(A):</strong> 14 AWG aluminum is not permitted. Minimum aluminum conductor size is 12 AWG.</div>';
            } else if (amps > wireAmp) {
                html += '<div class="warning-box"><strong>Ampacity exceeded:</strong> ' + sizeLabel(wireSize) + ' ' + cap(material) + ' is rated for ' + wireAmp + 'A at 60\u00B0C (NEC 310.16). Your load is ' + amps + 'A. Verify conductor capacity with the <a href="/tools/wire-size/"><strong>Wire Size Calculator</strong></a>.</div>';
            }

            html += infoNote;

            var formulaName = (circuit === '3ac') ? 'VD = (1.732 \u00D7 L \u00D7 I \u00D7 R) / 1000' : 'VD = (2 \u00D7 L \u00D7 I \u00D7 R) / 1000';
            html += buildShowWork(formulaName,
                'VD = (' + formulaLabel + ' \u00D7 ' + distance + ' \u00D7 ' + amps + ' \u00D7 ' + R + ') / 1000',
                'VD = ' + vd.toFixed(4) + ' V',
                [
                    ['L (one-way distance)', distance + ' ft'],
                    ['I (load current)', amps + ' A'],
                    ['R (resistance per 1000ft)', R + ' \u03A9 \u2014 NEC Table 8, ' + sizeLabel(wireSize) + ' ' + cap(material)],
                    ['Factor', formulaLabel + (circuit === '3ac' ? ' (\u221A3 for three-phase)' : ' (single-phase / DC round-trip)')],
                    ['Voltage Drop %', '(' + vd.toFixed(4) + ' / ' + voltage + ') \u00D7 100 = ' + vdPct.toFixed(2) + '%'],
                    ['Delivered voltage', voltage + ' \u2212 ' + vd.toFixed(2) + ' = ' + deliveredV.toFixed(1) + ' V']
                ]
            );

        // ── MAX DISTANCE ──
        } else if (currentMode === 'distance') {
            var wireSize = document.getElementById('wireSize').value;
            var R = wireResistance[material][wireSize];
            var maxDist3 = (0.03 * voltage * 1000) / (factor * amps * R);
            var maxDist5 = (0.05 * voltage * 1000) / (factor * amps * R);

            html += '<div style="font-weight:700;font-size:1.1rem;margin-bottom:14px;padding:10px 16px;background:#f5f0e6;border-left:4px solid var(--accent);border-radius:0 6px 6px 0;color:var(--text);">Response</div>';
            html += '<div class="result-section">';
            html += '<div class="result-value">' + Math.floor(maxDist3) + ' ft</div>';
            html += '<div class="result-label">Max distance at 3% Voltage Drop \u2014 ' + sizeLabel(wireSize) + ' ' + cap(material) + '</div>';
            html += '</div>';
            html += '<div class="result-section" style="margin-top:10px;">';
            html += '<div class="result-value">' + Math.floor(maxDist5) + ' ft</div>';
            html += '<div class="result-label">Max distance at 5% Voltage Drop \u2014 ' + sizeLabel(wireSize) + ' ' + cap(material) + '</div>';
            html += '</div>';
            html += '<table class="breakdown-table">';
            html += '<tr><td>Circuit</td><td>' + voltage + 'V ' + circuitLabel(circuit) + ' \u2014 ' + amps + 'A</td></tr>';
            html += '<tr><td>Wire</td><td>' + sizeLabel(wireSize) + ' ' + cap(material) + '</td></tr>';
            html += '<tr><td>Resistance (Table 8)</td><td>' + R + ' \u03A9/1000ft</td></tr>';
            html += '<tr><td>At 3% Voltage Drop</td><td>' + Math.floor(maxDist3) + ' ft (' + (0.03 * voltage).toFixed(1) + 'V drop)</td></tr>';
            html += '<tr><td>At 5% Voltage Drop</td><td>' + Math.floor(maxDist5) + ' ft (' + (0.05 * voltage).toFixed(1) + 'V drop)</td></tr>';
            html += '</table>';

            var wireAmp = basicAmpacity[material][wireSize];
            if (wireAmp === null) {
                html += '<div class="warning-box"><strong>NEC 310.3(A):</strong> 14 AWG aluminum is not permitted. Minimum aluminum conductor size is 12 AWG.</div>';
            } else if (amps > wireAmp) {
                html += '<div class="warning-box"><strong>Ampacity exceeded:</strong> ' + sizeLabel(wireSize) + ' ' + cap(material) + ' is rated for ' + wireAmp + 'A at 60\u00B0C (NEC 310.16). Your load is ' + amps + 'A. Verify conductor capacity with the <a href="/tools/wire-size/"><strong>Wire Size Calculator</strong></a>.</div>';
            }

            html += infoNote;

            var formulaName = (circuit === '3ac') ? 'L = (VD% \u00D7 V \u00D7 1000) / (1.732 \u00D7 I \u00D7 R)' : 'L = (VD% \u00D7 V \u00D7 1000) / (2 \u00D7 I \u00D7 R)';
            html += buildShowWork(formulaName,
                'L = (0.03 \u00D7 ' + voltage + ' \u00D7 1000) / (' + formulaLabel + ' \u00D7 ' + amps + ' \u00D7 ' + R + ')',
                'L = ' + maxDist3.toFixed(1) + ' ft (at 3%)',
                [
                    ['V (system voltage)', voltage + ' V'],
                    ['I (load current)', amps + ' A'],
                    ['R (resistance per 1000ft)', R + ' \u03A9 \u2014 NEC Table 8, ' + sizeLabel(wireSize) + ' ' + cap(material)],
                    ['Factor', formulaLabel + (circuit === '3ac' ? ' (\u221A3 for three-phase)' : ' (single-phase / DC round-trip)')],
                    ['At 3%', 'L = (0.03 \u00D7 ' + voltage + ' \u00D7 1000) / (' + formulaLabel + ' \u00D7 ' + amps + ' \u00D7 ' + R + ') = ' + maxDist3.toFixed(1) + ' ft \u2192 ' + Math.floor(maxDist3) + ' ft'],
                    ['At 5%', 'L = (0.05 \u00D7 ' + voltage + ' \u00D7 1000) / (' + formulaLabel + ' \u00D7 ' + amps + ' \u00D7 ' + R + ') = ' + maxDist5.toFixed(1) + ' ft \u2192 ' + Math.floor(maxDist5) + ' ft']
                ]
            );

        // ── SIZE CONDUCTOR ──
        } else if (currentMode === 'conductor') {
            var distance = parseFloat(document.getElementById('distance').value);
            if (!distance) { return; }

            var startIdx = (material === 'aluminum') ? 1 : 0;
            var rec3 = null, rec3VD = 0;
            var rec5 = null, rec5VD = 0;

            for (var i = startIdx; i < wireSizes.length; i++) {
                var size = wireSizes[i];
                var R = wireResistance[material][size];
                var vd = calcVD(R, factor, distance, amps);
                var vdPct = (vd / voltage) * 100;
                if (!rec5 && vdPct <= 5) { rec5 = size; rec5VD = vdPct; }
                if (!rec3 && vdPct <= 3) { rec3 = size; rec3VD = vdPct; break; }
            }

            html += '<div style="font-weight:700;font-size:1.1rem;margin-bottom:14px;padding:10px 16px;background:#f5f0e6;border-left:4px solid var(--accent);border-radius:0 6px 6px 0;color:var(--text);">Response</div>';

            if (!rec5) {
                html += '<div class="result-section">';
                html += '<div class="result-value result-fail">No Standard Size</div>';
                html += '<div class="result-label">No single conductor keeps voltage drop under 5% at ' + distance + ' ft and ' + amps + 'A. Consider parallel runs or higher system voltage.</div>';
                html += '</div>';
            } else {
                // 3% result
                if (rec3) {
                    var R3 = wireResistance[material][rec3];
                    var vd3Volts = rec3VD / 100 * voltage;
                    html += '<div class="result-section">';
                    html += '<div class="result-value">' + sizeLabel(rec3) + ' ' + cap(material) + '</div>';
                    html += '<div class="result-label">Minimum conductor for 3% Voltage Drop</div>';
                    html += '</div>';
                } else {
                    html += '<div class="result-section">';
                    html += '<div class="result-value result-fail">No standard size for 3%</div>';
                    html += '<div class="result-label">No single conductor keeps voltage drop under 3% at this distance and load.</div>';
                    html += '</div>';
                }

                // 5% result
                var R5 = wireResistance[material][rec5];
                var vd5Volts = rec5VD / 100 * voltage;
                if (rec3 && rec3 === rec5) {
                    html += '<div class="info-box" style="margin-top:10px;">' + sizeLabel(rec3) + ' ' + cap(material) + ' meets both the 3% and 5% voltage drop limits.</div>';
                } else {
                    html += '<div class="result-section" style="margin-top:10px;">';
                    html += '<div class="result-value">' + sizeLabel(rec5) + ' ' + cap(material) + '</div>';
                    html += '<div class="result-label">Minimum conductor for 5% Voltage Drop</div>';
                    html += '</div>';
                }

                // Breakdown table
                html += '<table class="breakdown-table">';
                html += '<tr><td>Circuit</td><td>' + voltage + 'V ' + circuitLabel(circuit) + ' \u2014 ' + amps + 'A @ ' + distance + ' ft</td></tr>';
                if (rec3) {
                    html += '<tr><td>At 3% Voltage Drop</td><td>' + sizeLabel(rec3) + ' ' + cap(material) + ' \u2014 ' + rec3VD.toFixed(2) + '% (' + (rec3VD / 100 * voltage).toFixed(1) + 'V drop, ' + (voltage - rec3VD / 100 * voltage).toFixed(1) + 'V delivered)</td></tr>';
                }
                html += '<tr><td>At 5% Voltage Drop</td><td>' + sizeLabel(rec5) + ' ' + cap(material) + ' \u2014 ' + rec5VD.toFixed(2) + '% (' + (rec5VD / 100 * voltage).toFixed(1) + 'V drop, ' + (voltage - rec5VD / 100 * voltage).toFixed(1) + 'V delivered)</td></tr>';
                html += '</table>';

                // ── EGC Section ──
                var ocpdVal = document.getElementById('ocpd').value ? parseInt(document.getElementById('ocpd').value) : null;
                if (ocpdVal && rec3) {
                    var minEGC = getEGC(ocpdVal, material);

                    // Find ampacity minimum wire
                    var ampMin = null;
                    var ampStartIdx = (material === 'aluminum') ? 1 : 0;
                    for (var i = ampStartIdx; i < wireSizes.length; i++) {
                        var amp = basicAmpacity[material][wireSizes[i]];
                        if (amp !== null && amp >= amps) { ampMin = wireSizes[i]; break; }
                    }

                    html += '<div style="margin-top:20px;padding-top:16px;border-top:1px solid var(--border);">';
                    html += '<div style="font-weight:700;font-size:0.92rem;margin-bottom:8px;">Equipment Grounding Conductor <span class="nec-ref">250.122</span></div>';
                    html += '<table class="breakdown-table">';
                    html += '<tr><td>Min EGC per 250.122</td><td>' + sizeLabel(minEGC) + ' ' + cap(material) + '</td></tr>';

                    // Check if VD wire is larger than ampacity min → proportional increase
                    var vdWireIdx = wireSizes.indexOf(rec3);
                    var ampMinIdx = ampMin ? wireSizes.indexOf(ampMin) : -1;

                    if (ampMin && vdWireIdx > ampMinIdx) {
                        var ampMinCmil = cmil[ampMin];
                        var vdCmil = cmil[rec3];
                        var ratio = vdCmil / ampMinCmil;
                        var egcCmil = cmil[minEGC];
                        var scaledCmil = egcCmil * ratio;
                        var suggestedEGC = nextSizeUp(scaledCmil, material);

                        html += '<tr><td>Ungrounded conductor (ampacity)</td><td>' + sizeLabel(ampMin) + ' \u2014 ' + ampMinCmil.toLocaleString() + ' cmil</td></tr>';
                        html += '<tr><td>Ungrounded conductor (VD sized)</td><td>' + sizeLabel(rec3) + ' \u2014 ' + vdCmil.toLocaleString() + ' cmil</td></tr>';
                        html += '<tr><td>Conductor increase</td><td>' + vdCmil.toLocaleString() + ' \u00F7 ' + ampMinCmil.toLocaleString() + ' = ' + ratio.toFixed(3) + ' (' + (ratio * 100).toFixed(0) + '%)</td></tr>';
                        html += '<tr><td>Base EGC (250.122)</td><td>' + sizeLabel(minEGC) + ' \u2014 ' + egcCmil.toLocaleString() + ' cmil</td></tr>';
                        html += '<tr><td>Proportional EGC calc</td><td>' + egcCmil.toLocaleString() + ' \u00D7 ' + ratio.toFixed(3) + ' = ' + Math.round(scaledCmil).toLocaleString() + ' cmil</td></tr>';
                        html += '<tr style="font-weight:700;"><td>Suggested EGC [250.122(B)]</td><td>' + sizeLabel(suggestedEGC) + ' ' + cap(material) + ' (' + cmil[suggestedEGC].toLocaleString() + ' cmil)</td></tr>';
                    }

                    html += '</table>';
                    html += '</div>';
                }
            }

            html += infoNote;

            // Show Your Work
            if (rec3) {
                var R3 = wireResistance[material][rec3];
                var formulaName = (circuit === '3ac') ? 'VD = (1.732 \u00D7 L \u00D7 I \u00D7 R) / 1000' : 'VD = (2 \u00D7 L \u00D7 I \u00D7 R) / 1000';
                var steps = [
                    ['L (one-way distance)', distance + ' ft'],
                    ['I (load current)', amps + ' A'],
                    ['Factor', formulaLabel + (circuit === '3ac' ? ' (\u221A3 for three-phase)' : ' (single-phase / DC round-trip)')]
                ];
                if (rec5 !== rec3) {
                    var R5 = wireResistance[material][rec5];
                    steps.push(['For 5% limit', sizeLabel(rec5) + ': R = ' + R5 + ' \u03A9/1000ft \u2192 VD = ' + rec5VD.toFixed(2) + '% (' + (rec5VD / 100 * voltage).toFixed(2) + 'V)']);
                }
                steps.push(['For 3% limit', sizeLabel(rec3) + ': R = ' + R3 + ' \u03A9/1000ft \u2192 VD = ' + rec3VD.toFixed(2) + '% (' + (rec3VD / 100 * voltage).toFixed(2) + 'V)']);

                html += buildShowWork(formulaName,
                    'VD = (' + formulaLabel + ' \u00D7 ' + distance + ' \u00D7 ' + amps + ' \u00D7 ' + R3 + ') / 1000',
                    'VD = ' + (rec3VD / 100 * voltage).toFixed(4) + ' V (' + rec3VD.toFixed(2) + '%)',
                    steps
                );
            }
        }

        var resultEl = document.getElementById('result');
        resultEl.innerHTML = html;
        resultEl.classList.add('show');
    }

    // ── Initialize ──
    setMode('check');
    </script>
    <script src="/js/app.js" defer></script>
</body>
</html>
